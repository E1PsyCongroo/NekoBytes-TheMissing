<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="./static/css/base.css" rel="stylesheet">
    <link href="./static/css/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.font.im/css?family=Source+Serif+Pro%7CLato%7CInconsolata" rel="stylesheet"
        type="text/css">
    <title> lecture3 </title>
    <!-- browser favicon -->
    <link rel="shortcut icon" href="./static/img/favicon.png">
    <style>
        .font-sans {
            font-family: 'Lato', 'SimHei', 'STHeiti', 'SimHei', 'Serif';
        }

        .font-serif {
            font-family: 'Source Serif Pro', 'Songti SC', 'SimSun', 'Serif', serif;
        }
    </style>
    <!-- <link rel="stylesheet" href="https://jyywiki.cn/static/katex/katex.min.css">
    <script defer src="https://jyywiki.cn/static/katex/katex.min.js"></script> -->
    <link rel="stylesheet" href="./static/katex/katex.min.css">
    <script defer src="./static/katex/katex.min.js"></script>
    <!-- <script defer src="https://jyywiki.cn/static/katex/auto-render.min.js"
        integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05"
        crossorigin="anonymous"></script> -->
    <script defer src="./static/katex/auto-render.min.js"></script>
    <script src="plugin/markdown/markdown.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            renderMathInElement(document.body, {
                // customised options
                // &#8226; auto-render specific keys, e.g.:
                delimiters: [
                    { left: '$$', right: '$$', display: true },
                    { left: '$', right: '$', display: false },
                    { left: '\\(', right: '\\)', display: false },
                    { left: '\\[', right: '\\]', display: true }
                ],
                // &#8226; rendering keys, e.g.:
                throwOnError: false
            });
        });
    </script>

    <link rel="stylesheet" href="./static/reveal/reveal.css">
    <link rel="stylesheet" href="./static/reveal/theme/simple.css" id="theme">
    <link rel="stylesheet" href="./static/jyy/jyy.css">

</head>

<body class="d-flex flex-column h-100">

    <div class="reveal">
        <div class="slides">
            <section><section><div class="center middle"><div style="width:100%"><div><h1 id="_1" class="text-2xl mt-2 font-sans">ä»è½¯ä»¶åˆ°ç¡¬ä»¶</h1><p class="font-serif my-1">
    <include src="Slides_Author">
        <div class="py-16">
            <p class="font-serif my-1">
                <a href="" class=" text-amber-900">
                    è‡ªç”±
                </a>
            </p>
        </div>
        <div class="row">
            <p class="font-serif my-1"/>
            
            <div class="author-affiliation">
                <a href="https://github.com/E1PsyCongroo/NekoBytes-TheMissing" class=" text-amber-900">
                    <p class="font-serif my-1">
                        NekoBytes
                    </p>
                    <img class="inline-img h-24" src="./static/img/c3ae71a350e34f17ae8aac4cea7c375e.svg" style="display: inline-block;"/>
                </a>
            </div>
            
        </div>
    </include>
</p></div></div></div></section></section><section><section><div><h2 id="cpu" class="text-xl mt-2 pb-2 font-sans">CPU</h2>
<hr/>
<hr/>
<ul class="list-disc font-serif">
<li class="ml-8">æŒ‡ä»¤é›†</li>
<li class="ml-8">æ±‡ç¼–è¯­è¨€å’Œæœºå™¨è¯­è¨€</li>
<li class="ml-8">å›¾çµæœº</li>
<li class="ml-8">CPUçš„ç»„æˆ</li>
</ul></div></section><section><div><h2 id="_1" class="text-xl mt-2 pb-2 font-sans">æŒ‡ä»¤é›†</h2>
<hr/>
<hr/>
<ul class="list-disc font-serif">
<li class="ml-8">è¾“å…¥çš„æŒ‡ä»¤ -&gt; è¦åšä»€ä¹ˆæ“ä½œ</li>
<li class="ml-8">ç¨‹åºå‘˜å’ŒCPUçš„ä¸€ç§çº¦å®š</li>
</ul>
<hr/>
<ul class="list-disc font-serif">
<li class="ml-8">å¸¸è§çš„æŒ‡ä»¤é›†ï¼š <ul class="list-disc font-serif">
<li class="ml-8">x86_64(amd64)</li>
<li class="ml-8">ARM</li>
<li class="ml-8">RISC-V</li>
<li class="ml-8">LoongArch</li>
</ul>
</li>
</ul></div></section><section><div><h2 id="_1" class="text-xl mt-2 pb-2 font-sans">æ±‡ç¼–è¯­è¨€å’Œæœºå™¨è¯­è¨€</h2>
<ul class="list-disc font-serif">
<li class="ml-8">æœºå™¨è¯­è¨€</li>
</ul>
<div class="codehilite"><pre class="bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span/><code>00000040: 4111 06e4 22e0 0008 1705 0000 1305 0500
00000050: 9700 0000 e780 0000 8147 3e85 a260 0264
00000060: 4101 8280
</code></pre></div>

<ul class="list-disc font-serif">
<li class="ml-8">æ±‡ç¼–è¯­è¨€</li>
</ul>
<div class="codehilite"><pre class="bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span/><code><span class="nl">main:</span>
<span class="w">        </span><span class="nf">addi</span><span class="w">    </span><span class="no">sp</span><span class="p">,</span><span class="no">sp</span><span class="p">,-</span><span class="mi">16</span>
<span class="w">        </span><span class="nf">sd</span><span class="w">      </span><span class="no">ra</span><span class="p">,</span><span class="mi">8</span><span class="p">(</span><span class="no">sp</span><span class="p">)</span>
<span class="w">        </span><span class="nf">sd</span><span class="w">      </span><span class="no">s0</span><span class="p">,</span><span class="mi">0</span><span class="p">(</span><span class="no">sp</span><span class="p">)</span>
<span class="w">        </span><span class="nf">addi</span><span class="w">    </span><span class="no">s0</span><span class="p">,</span><span class="no">sp</span><span class="p">,</span><span class="mi">16</span>
</code></pre></div>

<hr/>

<p class="font-serif my-1">å‡ ä¹æ˜¯ç®€å•çš„æ›¿æ¢</p></div></section><section><div><h2 id="_1" class="text-xl mt-2 pb-2 font-sans">æ±‡ç¼–è¯­è¨€å’Œæœºå™¨è¯­è¨€</h2>
<p class="font-serif my-1">å‡ ä¹æ˜¯ç®€å•çš„æ›¿æ¢</p>
<div class="codehilite"><pre class="bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span/><code>0000000000000000 &lt;main&gt;:
   0:   1141        addi    sp,sp,-16
   2:   e406        sd      ra,8(sp)
   4:   e022        sd      s0,0(sp)
   6:   0800        addi    s0,sp,16
   8:   00000517    auipc   a0,0x0
   c:   00050513    mv  a0,a0
  10:   00000097    auipc   ra,0x0
  14:   000080e7    jalr    ra #10 &lt;main+0x10&gt;
  18:   4781        li  a5,0
  1a:   853e        mv  a0,a5
  1c:   60a2        ld  ra,8(sp)
  1e:   6402        ld  s0,0(sp)
  20:   0141        addi    sp,sp,16
  22:   8082        ret
</code></pre></div></div></section><section><div><h2 id="_1" class="text-xl mt-2 pb-2 font-sans">ä½“ä¼šé«˜çº§è¯­è¨€åˆ°æœºå™¨è¯­è¨€</h2>
<hr/>
<ul class="list-disc font-serif">
<li class="ml-8">Cè¯­è¨€<code>main.c</code> -&gt; æ±‡ç¼–è¯­è¨€<code>main.S</code></li>
</ul>
<div class="codehilite"><pre class="bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span/><code>gcc<span class="w"> </span>./main.c<span class="w"> </span>-S<span class="w"> </span>./main.S
</code></pre></div>

<ul class="list-disc font-serif">
<li class="ml-8">æ±‡ç¼–è¯­è¨€<code>main.S</code> -&gt; å¯æ‰§è¡Œæ–‡ä»¶<code>main.out</code></li>
</ul>
<div class="codehilite"><pre class="bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span/><code>gcc<span class="w"> </span>./main.S<span class="w"> </span>-o<span class="w"> </span>./main.out
</code></pre></div>

<hr/>
<hr/>
<blockquote>
<p class="font-serif my-1"><code>main.out</code>å¹¶ä¸åªåŒ…å«äº†æœºå™¨è¯­è¨€ï¼Œè¿˜åŒ…å«äº†æŒ‡ç¤ºç³»ç»Ÿå¦‚ä½•è¿è¡Œè¿™ä¸ªæ–‡ä»¶çš„ä¿¡æ¯ã€‚</p>
</blockquote></div></section><section><div><h2 id="_1" class="text-xl mt-2 pb-2 font-sans">å›¾çµæœº</h2>
<ul class="list-disc font-serif">
<li class="ml-8">CPUå¦‚ä½•è‡ªåŠ¨è®¡ç®—ï¼Ÿ</li>
<li class="ml-8">ä¸‹ä¸€æ¡æŒ‡ä»¤åœ¨å“ªé‡Œï¼Ÿ â€”â€” ç¨‹åºè®¡æ•°å™¨PC</li>
</ul>
<hr/>

<div class="codehilite"><pre class="bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span/><code><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">ä»PCæŒ‡ç¤ºçš„å­˜å‚¨å™¨ä½ç½®å–å‡ºæŒ‡ä»¤</span><span class="p">;</span>
<span class="w">  </span><span class="n">æ‰§è¡ŒæŒ‡ä»¤</span><span class="p">;</span>
<span class="w">  </span><span class="n">æ›´æ–°PC</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<ul class="list-disc font-serif">
<li class="ml-8">å›¾çµæœº<ul class="list-disc font-serif">
<li class="ml-8">å­˜å‚¨å™¨ã€PCã€åŠ æ³•å™¨</li>
<li class="ml-8">ä»PCæŒ‡ç¤ºçš„å­˜å‚¨å™¨ä½ç½®å–æŒ‡ -&gt; æ‰§è¡Œ -&gt; æ›´æ–°PC</li>
</ul>
</li>
</ul></div></section><section><div><h2 id="cpu" class="text-xl mt-2 pb-2 font-sans">CPUçš„ç»„æˆ</h2>
<h3 id="register">å¯„å­˜å™¨ Register</h3>
<ul class="list-disc font-serif">
<li class="ml-8">CPUçš„å†…éƒ¨å­˜å‚¨å™¨</li>
<li class="ml-8">å¿«é€Ÿå­˜å‚¨å’Œè®¿é—®</li>
</ul>
<h3 id="alu">ç®—æ•°é€»è¾‘å•å…ƒ ALU</h3>
<ul class="list-disc font-serif">
<li class="ml-8">æ‰§è¡Œå„ç§é€»è¾‘è¿ç®—</li>
<li class="ml-8">æ ¹æ®ä¿¡å·é€‰æ‹©è¾“å‡º</li>
</ul>
<h3 id="_1">æ€»çº¿</h3>
<ul class="list-disc font-serif">
<li class="ml-8">CPUä¸å¤–éƒ¨è®¾å¤‡äº¤äº’ã€å„ç§åè®®</li>
</ul>
<h3 id="_2">ç¼“å­˜</h3>
<ul class="list-disc font-serif">
<li class="ml-8">å¤–è®¾é€Ÿåº¦å’ŒCPUé€Ÿåº¦å·®å¼‚</li>
<li class="ml-8">å¿«é€Ÿè®¿é—®</li>
</ul></div></section><section><div><h2 id="cpu" class="text-xl mt-2 pb-2 font-sans">CPUçš„æ‰§è¡Œè¿‡ç¨‹</h2>
<blockquote>
<p class="font-serif my-1"><code>addi x1, x0, 0xf</code> (<code>0x00f00093</code>)</p>
</blockquote>
<p class="font-serif my-1"><img class="center" src="./static/img/0cdbbaccab90465ba58c685485c2cd30.svg" width="960px"/></p></div></section></section><section><section><div><h2 id="_1" class="text-xl mt-2 pb-2 font-sans">å†¯è¯ºä¾æ›¼è®¡ç®—æœºç³»ç»Ÿ</h2>
<ul class="list-disc font-serif">
<li class="ml-8">
<p class="font-serif my-1">è¿ç®—å™¨ï¼šALU</p>
</li>
<li class="ml-8">
<p class="font-serif my-1">æ§åˆ¶å™¨ï¼šè¯‘ç å•å…ƒ</p>
</li>
<li class="ml-8">
<p class="font-serif my-1">å­˜å‚¨å™¨ï¼šå†…å­˜ã€å¯„å­˜å™¨</p>
</li>
<li class="ml-8">
<p class="font-serif my-1">è¾“å…¥è®¾å¤‡ï¼šé”®ç›˜ã€é¼ æ ‡</p>
</li>
<li class="ml-8">
<p class="font-serif my-1">è¾“å‡ºè®¾å¤‡ï¼šæ˜¾ç¤ºå™¨</p>
</li>
</ul>
<blockquote>
<p class="font-serif my-1">å†¯è¯ºä¾æ›¼è®¡ç®—æœºç³»ç»Ÿçš„å­˜å‚¨å™¨å’Œè¿ç®—å™¨æ˜¯åˆ†ç¦»çš„ã€‚</p>
</blockquote></div></section></section><section><section><div><h2 id="_1" class="text-xl mt-2 pb-2 font-sans">çŠ¶æ€æœº</h2>
<ul class="list-disc font-serif">
<li class="ml-8">æœ‰çŠ¶æ€</li>
<li class="ml-8">ä¼šæ ¹æ®è¾“å…¥æ”¹å˜è‡ªèº«çš„çŠ¶æ€ï¼ˆæ¿€åŠ±ï¼‰</li>
<li class="ml-8">ç®€å•çš„çŠ¶æ€æœº<ul class="list-disc font-serif">
<li class="ml-8"><strong>å®‰é™çŠ¶æ€</strong> â†’ <em>çœ‹åˆ°äºº</em> â†’ <strong>å å«çŠ¶æ€</strong></li>
<li class="ml-8"><strong>å å«çŠ¶æ€</strong> â†’ <em>äººç»™é¦™è‚ </em> â†’ <strong>è¿›é£ŸçŠ¶æ€</strong></li>
<li class="ml-8"><strong>è¿›é£ŸçŠ¶æ€</strong> â†’ <em>åƒå®Œé¦™è‚ </em> â†’ <strong>å®‰é™çŠ¶æ€</strong></li>
</ul>
</li>
</ul></div></section><section><div><h2 id="_1" class="text-xl mt-2 pb-2 font-sans">è®¡ç®—æœºæ˜¯ä¸ªçŠ¶æ€æœº</h2>
<ul class="list-disc font-serif">
<li class="ml-8">çŠ¶æ€ï¼šå¯„å­˜å™¨ã€å†…å­˜çš„å€¼</li>
<li class="ml-8">æ¿€åŠ±ï¼šå¤–éƒ¨çš„è¾“å…¥ã€æŒ‡ä»¤çš„å˜æ›´</li>
</ul>
<hr/>
<hr/>

<h2 id="_2" class="text-xl mt-2 pb-2 font-sans">ç¨‹åºæ˜¯ä¸ªçŠ¶æ€æœº</h2>
<ul class="list-disc font-serif">
<li class="ml-8">çŠ¶æ€ï¼Ÿ</li>
<li class="ml-8">æ¿€åŠ±ï¼šæ‰§è¡Œæ–°çš„æŒ‡ä»¤</li>
</ul></div></section></section><section><section><div><h2 id="_1" class="text-xl mt-2 pb-2 font-sans">æ“ä½œç³»ç»Ÿ</h2>
<ul class="list-disc font-serif">
<li class="ml-8">ä»€ä¹ˆæ˜¯æ“ä½œç³»ç»Ÿï¼Ÿ</li>
<li class="ml-8">ç¡¬ä»¶è§†è§’çš„æ“ä½œç³»ç»Ÿ</li>
<li class="ml-8">Three Easy Pieces</li>
</ul></div></section><section><div><h2 id="_1" class="text-xl mt-2 pb-2 font-sans">ä»€ä¹ˆæ˜¯æ“ä½œç³»ç»Ÿï¼Ÿ</h2>
<p class="font-serif my-1"><img class="center" src="./static/img/4f288e5a8a334bd8b4f74e798822dfd7.jpg" width="768px"/></p>
<div class="center">ç®¡ç†è¿›ç¨‹ã€æœåŠ¡è¿›ç¨‹ã€ç®¡ç†ç¡¬ä»¶</div></div></section><section><div><h2 id="_1" class="text-xl mt-2 pb-2 font-sans">å†…å­˜æ¨¡å‹ä¸è§„èŒƒ</h2>
<ul class="list-disc font-serif">
<li class="ml-8">æŒ‡ä»¤é›†ã€ç¼–è¯‘å™¨ã€æ“ä½œç³»ç»Ÿéµå¾ªåŒä¸€è§„èŒƒ<ul class="list-disc font-serif">
<li class="ml-8">System V ABI</li>
</ul>
</li>
</ul>
<p class="font-serif my-1"><img class="center" src="./static/img/730c1f2b36514d8ca1b5378bc4c615a1.svg" width="280px"/></p></div></section><section><div><h2 id="-" class="text-xl mt-2 pb-2 font-sans">å®éªŒ - æ ˆå’Œå †çš„åœ°å€</h2>
<div class="codehilite"><pre class="bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span/><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">"stack: %p"</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">x</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">"heap : %p"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
<span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p class="font-serif my-1">å¯èƒ½çš„è¾“å‡ºï¼š</p>
<div class="codehilite"><pre class="bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span/><code>stack: 0x7ffd27bb38dc
heap : 0x59e598fe42a0
</code></pre></div></div></section><section><div><h2 id="_1" class="text-xl mt-2 pb-2 font-sans">ç¡¬ä»¶è§†è§’çš„æ“ä½œç³»ç»Ÿ</h2>
<ul class="list-disc font-serif">
<li class="ml-8">åªæ˜¯ä¸€ä¸ªç®€å•çš„ç¨‹åºï¼ˆè£¸æœºç¨‹åºï¼‰</li>
<li class="ml-8">ä½†æ˜¯ç›´æ¥æ“ä½œç¡¬ä»¶<ul class="list-disc font-serif">
<li class="ml-8">ç›´æ¥å‘é€æŒ‡ä»¤ç»™ç£ç›˜</li>
<li class="ml-8">ç›´æ¥æ¥å—é”®ç›˜çš„åŸå§‹è¾“å…¥</li>
<li class="ml-8">ç›´æ¥â€¦â€¦</li>
</ul>
</li>
<li class="ml-8">ä»¥ç‰¹æ®Šçš„æ–¹å¼å¯åŠ¨å…¶å®ƒç¨‹åºï¼Œå°±åƒè°ƒç”¨ä¸€ä¸ªå‡½æ•°ä¸€æ ·<ul class="list-disc font-serif">
<li class="ml-8">å°†ç¨‹åºåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¹¶è·³è½¬åˆ°ç¨‹åºçš„å…¥å£å¤„ã€‚</li>
</ul>
</li>
</ul></div></section><section><div><h2 id="three-easy-pieces" class="text-xl mt-2 pb-2 font-sans">Three Easy Pieces</h2>
<ul class="list-disc font-serif">
<li class="ml-8">è™šæ‹ŸåŒ–<ul class="list-disc font-serif">
<li class="ml-8">æ‰€æœ‰è¿›ç¨‹éƒ½ä»¥ä¸ºè‡ªå·±æœ‰ä¸€æ•´ä¸ªè‹¹æœåƒ</li>
<li class="ml-8">ä»¥ä¸ºè‡ªå·±ç‹¬å CPUã€å†…å­˜â€¦â€¦</li>
</ul>
</li>
<li class="ml-8">å¹¶è¡Œ<ul class="list-disc font-serif">
<li class="ml-8">æµè§ˆå™¨ã€VSCodeç­‰ç¨‹åºä¸€èµ·è¿è¡Œï¼ŒåŒæ—¶ï¼Ÿ</li>
<li class="ml-8">åœ¨CPUä¸Šä¸æ–­åˆ‡æ¢æ­£åœ¨è¿è¡Œçš„ç¨‹åº</li>
</ul>
</li>
<li class="ml-8">æŒä¹…åŒ–<ul class="list-disc font-serif">
<li class="ml-8">æˆ‘çš„2048Gameå‡ºç°äº†16384ï¼ä½†æ˜¯è¿™æ¸¸æˆä¸èƒ½å­˜æ¡£ğŸ˜­ğŸ˜­ğŸ˜­</li>
<li class="ml-8">ç»„ç»‡æ–‡ä»¶ç³»ç»Ÿ</li>
</ul>
</li>
</ul></div></section><section><div><h2 id="-" class="text-xl mt-2 pb-2 font-sans">æ‹“å±• - ä½“éªŒå¹¶å‘</h2>
<div class="codehilite"><pre class="bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span/><code><span class="k">enum</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">SYS_EXIT</span><span class="p">,</span><span class="w">  </span><span class="c1">// Process exits</span>
<span class="w">    </span><span class="n">SYS_WRITE</span><span class="p">,</span><span class="w"> </span><span class="c1">// Write to console with a character</span>
<span class="p">};</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">syscall</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">arg</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">Syscall</span><span class="p">;</span>
</code></pre></div>

<div class="codehilite"><pre class="bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span/><code><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w">  </span><span class="n">remainingStep</span><span class="p">;</span><span class="w"> </span><span class="c1">// A process will run remainingStep steps</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">charToOutput</span><span class="p">;</span><span class="w">  </span><span class="c1">// A process will write this character </span>
<span class="w">                        </span><span class="c1">// to console by doing a syscall</span>
<span class="p">}</span><span class="w"> </span><span class="n">Process</span><span class="p">;</span><span class="w"> </span><span class="c1">// Process's Context</span>
</code></pre></div></div></section><section><div><h2 id="-" class="text-xl mt-2 pb-2 font-sans">æ‹“å±• - ä½“éªŒå¹¶å‘</h2>
<div class="codehilite"><pre class="bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span/><code><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Process</span><span class="w"> </span><span class="o">*</span><span class="n">current</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">process_count</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// The Operating System will randomly </span>
<span class="w">        </span><span class="c1">// choose a process to run</span>
<span class="w">        </span><span class="n">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">process_schedule</span><span class="p">();</span>
<span class="w">        </span><span class="c1">// Switch process context and run it until a syscall</span>
<span class="w">        </span><span class="n">Syscall</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">process_step</span><span class="p">(</span><span class="n">current</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">call</span><span class="p">.</span><span class="n">syscall</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">SYS_EXIT</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Process exits</span>
<span class="w">            </span><span class="n">process_exit</span><span class="p">(</span><span class="n">current</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">call</span><span class="p">.</span><span class="n">syscall</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">SYS_WRITE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Write the character from syscall arg to the console</span>
<span class="w">            </span><span class="n">putchar</span><span class="p">(</span><span class="n">call</span><span class="p">.</span><span class="n">arg</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">putchar</span><span class="p">(</span><span class="sc">'\n'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div></section><section><div><h2 id="-" class="text-xl mt-2 pb-2 font-sans">æ‹“å±• - ä½“éªŒå¹¶å‘</h2>
<div class="codehilite"><pre class="bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span/><code><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Initialize the Operating System</span>
<span class="w">    </span><span class="n">init</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// spawn processes</span>
<span class="w">    </span><span class="n">spawn_process</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="sc">'A'</span><span class="p">);</span>
<span class="w">    </span><span class="n">spawn_process</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="sc">'B'</span><span class="p">);</span>
<span class="w">    </span><span class="n">spawn_process</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="sc">'C'</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// start running</span>
<span class="w">    </span><span class="n">run</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p class="font-serif my-1">å¯èƒ½çš„è¾“å‡ºï¼š</p>
<div class="codehilite"><pre class="bg-gray-100 overflow-x-auto rounded p-2 mb-2 mt-2"><span/><code>AABCCCBBBCBCAAA
BBAACCCABBACCAB
CAAACBCCBBAACBB
</code></pre></div></div></section></section>
        </div>
    </div>

    <script src="./static/reveal/reveal.js"></script>

    <script>
        Reveal.initialize({

            width: 1024, height: 768,

            slideNumber: 'c/t',
            controlsTutorial: false,
            progress: false,
            hash: true,
            center: false,
            autoAnimateUnmatched: true,
            autoAnimateEasing: 'ease-out',
            autoAnimateDuration: 0.3,
            transitionSpeed: 'fast'
        });
    </script>
</body>

</html>